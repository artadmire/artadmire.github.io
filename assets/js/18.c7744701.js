(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{645:function(t,s,a){t.exports=a.p+"assets/img/fiber4.faa32a65.png"},646:function(t,s,a){t.exports=a.p+"assets/img/idle1.84ce33b4.png"},647:function(t,s,a){t.exports=a.p+"assets/img/idle2.6f47cec5.png"},648:function(t,s,a){t.exports=a.p+"assets/img/fiber5.3199e20b.png"},713:function(t,s,a){"use strict";a.r(s);var n=a(13),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"react-fiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-fiber"}},[t._v("#")]),t._v(" react fiber")]),t._v(" "),n("h2",{attrs:{id:"react-ä¸ºä»€ä¹ˆè¦ç”¨-fiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-ä¸ºä»€ä¹ˆè¦ç”¨-fiber"}},[t._v("#")]),t._v(" react ä¸ºä»€ä¹ˆè¦ç”¨ fiber ï¼Ÿ")]),t._v(" "),n("p",[t._v("stack reconciler -> fiber reconciler")]),t._v(" "),n("p",[t._v("åœ¨V16ç‰ˆæœ¬ä¹‹å‰ åè°ƒæœºåˆ¶ æ˜¯ Stack reconcilerï¼Œ V16ç‰ˆæœ¬å‘å¸ƒFiber æ¶æ„åæ˜¯ Fiber reconcilerã€‚")]),t._v(" "),n("p",[t._v("åœ¨setStateåï¼Œreactä¼šç«‹å³å¼€å§‹reconciliationè¿‡ç¨‹ï¼Œä»çˆ¶èŠ‚ç‚¹ï¼ˆVirtual DOMï¼‰å¼€å§‹é€’å½’éå†ï¼Œä»¥æ‰¾å‡ºä¸åŒã€‚å°†æ‰€æœ‰çš„Virtual DOMéå†å®Œæˆåï¼Œreconcileræ‰èƒ½ç»™å‡ºå½“å‰éœ€è¦ä¿®æ”¹çœŸå®DOMçš„ä¿¡æ¯ï¼Œå¹¶ä¼ é€’ç»™rendererï¼Œè¿›è¡Œæ¸²æŸ“ï¼Œç„¶åå±å¹•ä¸Šæ‰ä¼šæ˜¾ç¤ºæ­¤æ¬¡æ›´æ–°å†…å®¹ã€‚")]),t._v(" "),n("p",[t._v("å¯¹äºç‰¹åˆ«åºå¤§çš„DOMæ ‘æ¥è¯´ï¼Œreconciliationè¿‡ç¨‹ä¼šå¾ˆâ»“(x00ms)ï¼Œåœ¨è¿™æœŸé—´ï¼Œä¸»çº¿ç¨‹æ˜¯è¢«jså ç”¨çš„ï¼Œå› æ­¤ä»»ä½•äº¤äº’ã€å¸ƒå±€ã€æ¸²æŸ“éƒ½ä¼šåœæ­¢ï¼Œç»™ç”¨æˆ·çš„æ„Ÿè§‰å°±æ˜¯â»šé¢è¢«å¡ä½äº†ã€‚")]),t._v(" "),n("p",[t._v("åœ¨è¿™é‡Œæˆ‘ä»¬æƒ³è§£å†³è¿™ä¸ªé—®é¢˜çš„è¯,æ¥å¼•å…¥ä¸€ä¸ªæ¦‚å¿µ,å°±æ˜¯ä»»åŠ¡å¯ä¸­æ–­,ä»¥åŠä»»åŠ¡ä¼˜å…ˆçº§,ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„\nreconciliationçš„è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä¸€äº›ä»»åŠ¡å’Œå­ä»»åŠ¡,ç”¨æˆ·çš„æ“ä½œçš„ä»»åŠ¡ä¼˜å…ˆçº§æ˜¯è¦é«˜äºreconciliationäº§ç”Ÿçš„ä»»åŠ¡çš„,ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·æ“ä½œçš„ä»»åŠ¡æ˜¯å¯ä»¥æ‰“æ–­reconciliationä¸­äº§ç”Ÿå¾—ä»»åŠ¡çš„,å®ƒä¼šä¼˜å…ˆæ‰§è¡Œã€‚")]),t._v(" "),n("h2",{attrs:{id:"ä»€ä¹ˆæ˜¯fiber"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯fiber"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯fiber?")]),t._v(" "),n("p",[t._v("Fiber æ˜¯ React 16 ä¸­æ–°çš„åè°ƒå¼•æ“ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä½¿ Virtual DOM å¯ä»¥è¿›è¡Œå¢é‡å¼æ¸²æŸ“ã€‚\nä¸€ä¸ªæ›´æ–°è¿‡ç¨‹å¯èƒ½è¢«æ‰“æ–­ï¼Œæ‰€ä»¥React Fiberä¸€ä¸ªæ›´æ–°è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ(Phase)ï¼šç¬¬ä¸€ä¸ªé˜¶æ®µ\nReconciliation Phaseå’Œç¬¬äºŒé˜¶æ®µCommit Phaseã€‚")]),t._v(" "),n("p",[t._v("ä¸‹é¢åˆ—å‡ºä¸€ä¸ªç®€å•çš„fiberå®ç°ï¼Œå…ˆæ¥çœ‹ä¸‹fiberç»“æ„ï¼š")]),t._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token doctype"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),n("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token style"}},[n("span",{pre:!0,attrs:{class:"token language-css"}},[t._v("\n    "),n("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".box")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("min-height")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("margin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("border")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4px solid black"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("min-width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50px"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v("max-width")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fit-content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  ")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  a\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    b\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("d"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    c\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("d1"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("e1\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("d2"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("e2"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" div "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("dom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// div #root")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fiberRoot "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" dom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰nodeèŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çˆ¶èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sibling")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å…„å¼ŸèŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰€æœ‰å­èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("child")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" children "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("dom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" preFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" node "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fiberRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v("  children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        preFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        preFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        fiberRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" fiberRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br"),n("span",{staticClass:"line-number"},[t._v("66")]),n("br"),n("span",{staticClass:"line-number"},[t._v("67")]),n("br"),n("span",{staticClass:"line-number"},[t._v("68")]),n("br"),n("span",{staticClass:"line-number"},[t._v("69")]),n("br")])]),n("p",[t._v("fiberæœ‰å¤šä¸ªæŒ‡é’ˆï¼ŒreturnæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼ŒsiblingæŒ‡å‘ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚reactä¼šåœ¨renderå‡½æ•°ä¸­æ ¹æ®ä¼ é€’è¿›æ¥çš„vdomï¼Œæ„å»ºå‡ºfiberã€‚")]),t._v(" "),n("p",[t._v("éå†çš„è¿‡ç¨‹ï¼š")]),t._v(" "),n("p",[t._v("ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæœ‰å­èŠ‚ç‚¹å°±å…ˆéå†å­èŠ‚ç‚¹ï¼Œç›´åˆ°å½“å‰å­æ ‘ä¸å†æœ‰å­èŠ‚ç‚¹ï¼Œå¼€å§‹éå†å½“å‰èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œæ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹æœ‰å­å‡ ç‚¹ç»§ç»­éå†å­èŠ‚ç‚¹ï¼Œå¦‚æœä¹ˆæœ‰å­èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹äº†ï¼Œå°±returnå›åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå¼€å§‹éå†çˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ã€‚")]),t._v(" "),n("p",[t._v("ç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå°±å®Œæˆäº†ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ—¢æ²¡æœ‰å„¿å­åˆæ²¡æœ‰å¼Ÿå¼Ÿï¼Œå°±æ‰¾çˆ¶èŠ‚ç‚¹ã€‚å…ˆå¼€å§‹çš„åç»“æŸã€‚")]),t._v(" "),n("p",[t._v("ä¸Šé¢æ‰“å°fiberå¦‚ä¸‹å›¾ï¼š")]),t._v(" "),n("p",[n("img",{attrs:{src:a(645),alt:"fiber"}})]),t._v(" "),n("p",[t._v("fiberå…³é”®å±æ€§ï¼š")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * fiberæ¶æ„\n * type: æ ‡è®°ç±»å‹\n * key: æ ‡è®°å½“å‰å±‚çº§ä¸‹çš„å”¯ä¸€æ€§\n * child : ç¬¬ä¸€ä¸ªå­å…ƒç´  fiber\n * sibling ï¼š ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´  fiber\n * returnï¼š çˆ¶fiber\n * nodeï¼š çœŸå®domèŠ‚ç‚¹\n * propsï¼šå±æ€§å€¼\n * base: ä¸Šæ¬¡çš„èŠ‚ç‚¹ fiber\n * effectTag: æ ‡è®°è¦æ‰§è¡Œçš„æ“ä½œç±»å‹ï¼ˆåˆ é™¤ã€æ’å…¥ã€æ›´æ–°ï¼‰\n */")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("h2",{attrs:{id:"fiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜"}},[t._v("#")]),t._v(" fiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜")]),t._v(" "),n("h3",{attrs:{id:"react-çš„fiberæ”¹é€ "}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-çš„fiberæ”¹é€ "}},[t._v("#")]),t._v(" React çš„Fiberæ”¹é€ ")]),t._v(" "),n("ol",[n("li",[t._v("æ•°æ®ç»“æ„çš„è°ƒæ•´ï¼šä½¿ç”¨é“¾è¡¨\næ”¹é€ å‰ï¼šé€’å½’è°ƒç”¨æ ˆ:æ ˆæŒºå¥½çš„ï¼Œä»£ç é‡å°‘ï¼Œé€’å½’å®¹æ˜“ç†è§£, è‡³å°‘æ¯”ç°åœ¨çš„ React Fiberæ¶æ„å¥½ç†è§£ğŸ˜‚, é€’å½’éå¸¸é€‚åˆæ ‘è¿™ç§åµŒå¥—æ•°æ®ç»“æ„çš„å¤„ç†ã€‚åªä¸è¿‡è¿™ç§ä¾èµ–äºè°ƒç”¨æ ˆçš„æ–¹å¼ä¸èƒ½éšæ„ä¸­æ–­ã€ä¹Ÿå¾ˆéš¾è¢«æ¢å¤, ä¸åˆ©äºå¼‚æ­¥å¤„ç†ã€‚ è¿™ç§è°ƒç”¨æ ˆï¼Œä¸æ˜¯ç¨‹åºæ‰€èƒ½æ§åˆ¶çš„ï¼Œ å¦‚æœä½ è¦æ¢å¤é€’å½’ç°åœºï¼Œå¯èƒ½éœ€è¦ä»å¤´å¼€å§‹, æ¢å¤åˆ°ä¹‹å‰çš„è°ƒç”¨æ ˆã€‚")])]),t._v(" "),n("p",[t._v("æ”¹é€ åï¼šæ¨¡æ‹Ÿå‡½æ•°è°ƒç”¨æ ˆ, å°†ä¹‹å‰éœ€è¦é€’å½’è¿›è¡Œå¤„ç†çš„äº‹æƒ…åˆ†è§£æˆå¢é‡çš„æ‰§è¡Œå•å…ƒï¼Œå°†é€’å½’è½¬æ¢æˆè¿­ä»£**.")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("ä¸¤ä¸ªé˜¶æ®µçš„æ‹†åˆ†\nReconciliationï¼ˆdiffï¼‰é˜¶æ®µï¼šå› ä¸ºåè°ƒé˜¶æ®µå¯èƒ½è¢«ä¸­æ–­ã€æ¢å¤ï¼Œç”šè‡³é‡åšï¼Œâš ï¸React åè°ƒé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸé’©å­å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡!, ä¾‹å¦‚ componentWillMount å¯èƒ½ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ã€‚ç´¢æ€§ React17 å°±åºŸå¼ƒäº†è¿™éƒ¨åˆ†å¯èƒ½åŒ…å«å‰¯ä½œç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¾‹å¦‚componentWillMountã€componentWillUpdate")])]),t._v(" "),n("p",[t._v("commitæäº¤é˜¶æ®µï¼šæ­¤é˜¶æ®µè¦æ­£ç¡®åœ°å¤„ç†å„ç§å‰¯ä½œç”¨ï¼ŒåŒ…æ‹¬DOMå˜æ›´ã€è¿˜æœ‰ä½ åœ¨componentDidMountä¸­å‘èµ·çš„å¼‚æ­¥è¯·æ±‚ã€useEffect ä¸­å®šä¹‰çš„å‰¯ä½œç”¨... å› ä¸ºæœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯æŒ‰ç…§æ¬¡åºåªè°ƒç”¨ä¸€æ¬¡ï¼Œå†µä¸”ä¼šæœ‰ç”¨æˆ·å¯ä»¥å¯Ÿè§‰åˆ°çš„å˜æ›´, ä¸å®¹å·®æ± ã€‚")]),t._v(" "),n("h3",{attrs:{id:"ä»¥å‰çš„è°ƒåº¦ç­–ç•¥æ˜¯æ€æ ·çš„"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»¥å‰çš„è°ƒåº¦ç­–ç•¥æ˜¯æ€æ ·çš„"}},[t._v("#")]),t._v(" ä»¥å‰çš„è°ƒåº¦ç­–ç•¥æ˜¯æ€æ ·çš„ï¼Ÿ")]),t._v(" "),n("p",[t._v("ä»¥å‰æ˜¯diffç®—æ³•å’Œcommitæäº¤æ¸²æŸ“è¿‡ç¨‹å‡ä¸ºåŒæ­¥ï¼Œä¸€æ°”å‘µæˆï¼Œé€ æˆå¦‚æœé¡µé¢è¿‡å¤§ç”¨æ—¶ä¹Ÿä¼šè¿‡ä¹…ï¼Œæ²¡æœ‰ç»™ç”¨æˆ·äº¤äº’å“åº”çš„ç©ºé—´ï¼Œä»è€Œæ˜¾å¾—å¡é¡¿ã€‚")]),t._v(" "),n("h3",{attrs:{id:"fiberæœ¬è´¨ä¸Šè§£å†³çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆé—®é¢˜"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fiberæœ¬è´¨ä¸Šè§£å†³çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆé—®é¢˜"}},[t._v("#")]),t._v(" fiberæœ¬è´¨ä¸Šè§£å†³çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆé—®é¢˜ï¼Ÿ")]),t._v(" "),n("p",[t._v("reactæ¸²æŸ“é¡µé¢åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šdiffç®—æ³•é˜¶æ®µå’Œcommitæäº¤æ¸²æŸ“é˜¶æ®µï¼Œæ˜¯å…³äºå¤šä»»åŠ¡ï¼ˆäº¤äº’å“åº”ï¼Œä»¥åŠcssåŠ è½½è§£æï¼ŒjsåŠ è½½è§£æï¼Œæ¸²æŸ“æ ‘å¸ƒå±€ç»˜åˆ¶ç­‰ç­‰ï¼‰è°ƒåº¦ç­–ç•¥çš„ä¸€ä¸ªé—®é¢˜ã€‚")]),t._v(" "),n("p",[t._v("ä¸ºäº†ç»™ç”¨æˆ·åˆ¶é€ ä¸€ç§åº”ç”¨å¾ˆå¿«çš„'å‡è±¡'ï¼Œæˆ‘ä»¬ä¸èƒ½è®©ä¸€ä¸ªç¨‹åºé•¿æœŸéœ¸å ç€èµ„æº. ä½ å¯ä»¥å°†æµè§ˆå™¨çš„æ¸²æŸ“ã€å¸ƒå±€ã€ç»˜åˆ¶ã€èµ„æºåŠ è½½(ä¾‹å¦‚HTMLè§£æ)ã€äº‹ä»¶å“åº”ã€è„šæœ¬æ‰§è¡Œè§†ä½œæ“ä½œç³»ç»Ÿçš„'è¿›ç¨‹'ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æŸäº›è°ƒåº¦ç­–ç•¥åˆç†åœ°åˆ†é…CPUèµ„æºï¼Œä»è€Œæé«˜æµè§ˆå™¨çš„ç”¨æˆ·å“åº”é€Ÿç‡, åŒæ—¶å…¼é¡¾ä»»åŠ¡æ‰§è¡Œæ•ˆç‡ã€‚")]),t._v(" "),n("p",[t._v("ğŸ”´æ‰€ä»¥ React é€šè¿‡Fiber æ¶æ„ï¼Œè®©è‡ªå·±çš„Reconcilation(diff) è¿‡ç¨‹å˜æˆå¯è¢«ä¸­æ–­ã€‚ 'é€‚æ—¶'åœ°è®©å‡ºCPUæ‰§è¡Œæƒï¼Œé™¤äº†å¯ä»¥è®©æµè§ˆå™¨åŠæ—¶åœ°å“åº”ç”¨æˆ·çš„äº¤äº’ï¼Œè¿˜æœ‰å…¶ä»–å¥½å¤„:")]),t._v(" "),n("h2",{attrs:{id:"ä»»åŠ¡åˆ†ç‰‡å’Œæ—¶é—´åˆ†ç‰‡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä»»åŠ¡åˆ†ç‰‡å’Œæ—¶é—´åˆ†ç‰‡"}},[t._v("#")]),t._v(" ä»»åŠ¡åˆ†ç‰‡å’Œæ—¶é—´åˆ†ç‰‡")]),t._v(" "),n("p",[t._v("Fiberæ˜¯reactçš„16.8.0ç‰ˆæœ¬å¼•è¿›çš„å…¨æ–°çš„reconcileé€»è¾‘å’Œæ¦‚å¿µï¼ŒFiber æ˜¯ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œå®ƒçš„å¼•å…¥æ˜¯reactå®ç°ä»»åŠ¡åˆ†ç‰‡å’Œæ—¶é—´åˆ†ç‰‡çš„åŸºç¡€ã€‚åˆ†ç‰‡æ˜¯ä¸ºäº†åœ¨Reconciliationé˜¶æ®µï¼ˆçº¯jsè®¡ç®—ï¼Œæ— DOMæ“ä½œï¼‰ä¸€ç‚¹ä¸€ç‚¹åœ°æ‰§è¡Œä»»åŠ¡ï¼Œç»™æµè§ˆå™¨å–˜æ¯çš„æœºä¼šï¼Œä»è€Œåœ¨ä½“éªŒä¸Šç»™ç”¨æˆ·æ›´æµç•…çš„ä½¿ç”¨æ„Ÿå—ã€‚")]),t._v(" "),n("h2",{attrs:{id:"æ€è€ƒ-æ€ä¹ˆçŸ¥é“æµè§ˆå™¨ç©ºé—²äº†"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ€è€ƒ-æ€ä¹ˆçŸ¥é“æµè§ˆå™¨ç©ºé—²äº†"}},[t._v("#")]),t._v(" æ€è€ƒï¼šæ€ä¹ˆçŸ¥é“æµè§ˆå™¨ç©ºé—²äº†ï¼Ÿ")]),t._v(" "),n("h3",{attrs:{id:"requestidlecallback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#requestidlecallback"}},[t._v("#")]),t._v(" requestIdleCallback")]),t._v(" "),n("blockquote",[n("p",[t._v("å‚è€ƒï¼š")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/facebook/react/issues/7942#issuecomment-254987818",target:"_blank",rel:"noopener noreferrer"}},[t._v("react issues"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/facebook/react/issues/13206#issuecomment-418923831",target:"_blank",rel:"noopener noreferrer"}},[t._v("react issues"),n("OutboundLink")],1)])])]),t._v(" "),n("p",[t._v("window.requestIdleCallback()æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚")]),t._v(" "),n("p",[t._v("ç¼ºç‚¹ï¼š")]),t._v(" "),n("ul",[n("li",[t._v("å…¼å®¹æ€§")]),t._v(" "),n("li",[t._v("50msæ¸²æŸ“é—®é¢˜")]),t._v(" "),n("li",[t._v("20hzé—®é¢˜")])]),t._v(" "),n("p",[t._v("é€šå¸¸ FPS åœ¨ 60 çš„æ—¶å€™æ˜¯æ¯”è¾ƒæµç•…çš„, è€Œ FPS æ¯”è¾ƒä½çš„æ—¶å€™å°±ä¼šæ„Ÿè§‰åˆ°å¡é¡¿. chromeæ¯16.66msæ‰§è¡Œä¸€æ¬¡æ—¶é—´å¾ªç¯ã€‚é‚£ä¹ˆåœ¨æ¯ä¸€å¸§é‡Œæµè§ˆå™¨ä¼šåšå“ªäº›äº‹æƒ…å‘¢, å¦‚ä¸‹æ‰€ç¤º:")]),t._v(" "),n("p",[t._v("|--- task queue ---|--- micro task ---|---  rafï¼ˆåŠ¨ç”»ï¼‰  ---|--- render ---|--- requestIdleCallback ---|")]),t._v(" "),n("p",[n("strong",[t._v("ä»€ä¹ˆæ˜¯ç©ºé—²æ—¶é—´ï¼Ÿ")])]),t._v(" "),n("p",[t._v("æµè§ˆå™¨çš„ä¸»çº¿ç¨‹åœ¨æ¯ä¸€å¸§å¤„ç†å®Œç”¨æˆ·è¾“å…¥ã€åŠ¨ç”»è®¡ç®—ã€åˆæˆå¸§ç­‰æ“ä½œåï¼Œé€šå¸¸ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œç›´åˆ°ä¸‹ä¸€å¸§å¼€å§‹ã€æˆ–è€…æ”¶åˆ°æ–°çš„ç”¨æˆ·è¾“å…¥ã€æˆ–è€…pendingçš„ä»»åŠ¡æ»¡è¶³äº†æ‰§è¡Œæ¡ä»¶ç­‰ã€‚")]),t._v(" "),n("p",[n("img",{attrs:{src:a(646),alt:"idle1"}})]),t._v(" "),n("p",[t._v("å½“ç¨‹åºæ ˆä¸ºç©ºé¡µé¢æ— éœ€æ›´æ–°çš„æ—¶å€™, æµè§ˆå™¨å…¶å®æ˜¯å¤„äºç©ºé—²çŠ¶æ€, è¿™æ—¶å€™ç•™ç»™requestIdleCallbackæ‰§è¡Œçš„æ—¶é—´å°±å¯ä»¥é€‚å½“æ‹‰é•¿, æœ€é•¿è¾¾åˆ° 50ms, ä»¥é˜²å‡ºç°ä¸å¯é¢„æµ‹çš„ä»»åŠ¡(å¦‚ç”¨æˆ·è¾“å…¥), é¿å…æ— æ³•åŠæ—¶å“åº”ä½¿ç”¨æˆ·æ„ŸçŸ¥åˆ°å»¶è¿Ÿ.")]),t._v(" "),n("p",[n("img",{attrs:{src:a(647),alt:"idle2"}})]),t._v(" "),n("p",[t._v("ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½å¯ä»¥ç®—æ˜¯æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´ã€‚å¦‚æœæµè§ˆå™¨ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼ŒrequestIdleCallbackå°±ä¼šä¸€ç›´å¾—ä¸åˆ°è°ƒç”¨ï¼Œè™½ç„¶æœ‰ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å¼ºåˆ¶è°ƒç”¨ï¼Œä½†æ˜¯ä¾ç„¶ä¼šå¯¼è‡´æ¸²æŸ“ä¸ç¨³å®šçš„é—®é¢˜ã€‚")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("blockquote",[n("p",[t._v("requestIdleCallback is called only 20 times per second - Chrome on my 6x2 core Linux machine, it's not really useful for UI workã€‚â€”â€” from Releasing Suspenseã€‚")])]),t._v(" "),n("p",[t._v("ä¹Ÿå°±æ˜¯è¯´ requestIdleCallback çš„ FPS åªæœ‰ 20, è¿™è¿œè¿œä½äºé¡µé¢æµç•…åº¦çš„è¦æ±‚ï¼(ä¸€èˆ¬ FPS ä¸º 60 æ—¶å¯¹ç”¨æˆ·æ¥è¯´æ˜¯æ„Ÿè§‰æµç¨‹çš„, å³ä¸€å¸§æ—¶é—´ä¸º 16.7 ms), è¿™ä¹Ÿæ˜¯ React éœ€è¦è‡ªå·±å®ç° requestIdleCallback çš„åŸå› ä¹‹ä¸€ã€‚")]),t._v(" "),n("h3",{attrs:{id:"ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨generator"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨generator"}},[t._v("#")]),t._v(" ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨Generator")]),t._v(" "),n("p",[t._v("The biggest reason, however, is that generators are stateful. You can't resume in the middle of it.")]),t._v(" "),n("h3",{attrs:{id:"ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨settimeout"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨settimeout"}},[t._v("#")]),t._v(" ä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨setTimeOut")]),t._v(" "),n("p",[t._v("HTML Standardé‡Œæ˜ç¡®æŒ‡å‡ºäº†ä½¿ç”¨setTimeoutæ—¶ï¼š")]),t._v(" "),n("ul",[n("li",[t._v("å¦‚æœè®¾ç½®çš„timeoutå°äº0ï¼Œåˆ™è®¾ç½®ä¸º0")]),t._v(" "),n("li",[t._v("å¦‚æœåµŒå¥—çš„å±‚çº§è¶…è¿‡äº† 5 å±‚ï¼Œå¹¶ä¸” timeout å°äº 4msï¼Œåˆ™è®¾ç½® timeout ä¸º 4ms")])]),t._v(" "),n("p",[t._v("æ‰€ä»¥è¯´å­˜åœ¨4msçš„å»¶è¿Ÿã€‚")]),t._v(" "),n("p",[t._v("å› ä¸ºæµè§ˆå™¨æœ¬èº«ä¹Ÿæ˜¯åŸºäºevent loopçš„ï¼Œæ‰€ä»¥å¦‚æœæµè§ˆå™¨å…è®¸0msï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªå¾ˆæ…¢çš„jså¼•æ“ä¸æ–­è¢«å”¤é†’ï¼Œä»è€Œå¼•èµ·event loopé˜»å¡ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´å°±æ˜¯ç½‘ç«™æ— å“åº”ï¼Œè¿™æ˜¯è®©äººå¾ˆéš¾æ¥å—çš„ã€‚")]),t._v(" "),n("h3",{attrs:{id:"æœ€åçš„å®ç°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æœ€åçš„å®ç°"}},[t._v("#")]),t._v(" æœ€åçš„å®ç°")]),t._v(" "),n("p",[t._v("Fiber æ˜¯ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œå®ƒçš„å¼•å…¥æ˜¯reactå®ç°ä»»åŠ¡åˆ†ç‰‡å’Œæ—¶é—´åˆ†ç‰‡çš„åŸºç¡€ã€‚åˆ†ç‰‡æ˜¯ä¸ºäº†åœ¨Reconciliationé˜¶æ®µï¼ˆçº¯jsè®¡ç®—ï¼Œæ— DOMæ“ä½œï¼‰ä¸€ç‚¹ä¸€ç‚¹åœ°æ‰§è¡Œä»»åŠ¡ï¼Œç»™æµè§ˆå™¨å–˜æ¯çš„æœºä¼šï¼Œä»è€Œåœ¨ä½“éªŒä¸Šç»™ç”¨æˆ·æ›´æµç•…çš„ä½¿ç”¨æ„Ÿå—ã€‚")]),t._v(" "),n("p",[t._v("æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œä¼šè¢«Reactæ°›å›´6ä¸ªå·¥ä½œå•å…ƒï¼š")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ReactDOM "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-dom'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Title"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("a href"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nReactDOM"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRoot")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("App "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br")])]),n("p",[n("img",{attrs:{src:a(648),alt:"fiber5"}})]),t._v(" "),n("p",[t._v("å…¶ä¸­nullå¯¹åº”ç€fiberçš„æ ¹èŠ‚ç‚¹ï¼Œè™½ç„¶åœ¨è§†è§‰ä¸Šæ˜¯ä»€ä¹ˆéƒ½çœ‹ä¸è§çš„ï¼Œä½†å®ƒçš„ç¡®åœ¨å†…å­˜é‡Œã€‚å‰©ä¸‹çš„fiberèŠ‚ç‚¹éƒ½æ¯”è¾ƒå¥½ç†è§£ã€‚")]),t._v(" "),n("p",[t._v("æ¯å½“æ›´æ–°å‘ç”Ÿæ—¶ï¼Œreactä¼šä»fiberçš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å¾ªç¯éå†æ‰€æœ‰çš„fiberã€‚å½“shouldYieldè¿”å›trueçš„æ—¶å€™ï¼Œå¾ªç¯è¯­å¥ä¸­æ–­ï¼Œä¸€ä¸ªæ—¶é—´åˆ†ç‰‡å°±ç»“æŸäº†ï¼Œæµè§ˆå™¨å°†é‡è·æ§åˆ¶æƒã€‚")]),t._v(" "),n("p",[t._v("ä»€ä¹ˆæƒ…å†µä¸‹ä»»åŠ¡ä¸ºtrue?")]),t._v(" "),n("ul",[n("li",[t._v("æœ‰ç´§æ€¥ä»»åŠ¡æ’å…¥")]),t._v(" "),n("li",[t._v("æ‰§è¡Œæ—¶é—´å¤ªé•¿")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ­¤æ—¶ï¼Œæ˜¯å¦åº”è¯¥äº¤å‡ºæ‰§è¡Œæƒ å¦‚æœè¯´æœ‰ç”¨æˆ·è¾“å…¥ æˆ–è€…æ‰§è¡Œæ—¶é—´å¤ªé•¿(è¶…æ—¶) å…¶å®å°±æ˜¯è¿‡äº†16.66ms")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldYield")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" navigator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scheduling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isInputPending")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" deadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[n("strong",[t._v("ä¸­æ–­ä»»åŠ¡")])]),t._v(" "),n("p",[t._v("è·³å‡ºå¾ªç¯ä¹‹åï¼Œreactè¿˜åšäº†ä¸€ä»¶äº‹ï¼Œé€šè¿‡MessageChannelå‘èµ·äº†ä¸€ä¸ªpostMessageäº‹ä»¶ã€‚")]),t._v(" "),n("p",[n("strong",[t._v("æ¢å¤å¾ªç¯")])]),t._v(" "),n("p",[t._v("é€šè¿‡äº‹ä»¶ç›‘å¬åˆæ¢å¤äº†å¾ªç¯ã€‚")]),t._v(" "),n("p",[t._v("åœ¨å¾ªç¯ä¸­æ–­åˆ°äº‹ä»¶å“åº”çš„é—´éš™ï¼Œæµè§ˆå™¨é‡è·äº†æ§åˆ¶æƒï¼Œæ‰§è¡Œå¿…è¦çš„æ¸²æŸ“å·¥ä½œï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚")]),t._v(" "),n("p",[t._v("æ¨¡æ‹Ÿä»¥ä¸‹è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼š")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * schedule â€”> æŠŠæˆ‘çš„ä»»åŠ¡æ”¾è¿›ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç„¶åä»¥æŸä¸€ç§èŠ‚å¥è¿›è¡Œæ‰§è¡Œï¼›\n * \n */")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// task çš„ä»»åŠ¡é˜Ÿåˆ—")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" threshold "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" transtions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" deadline "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å½“å‰æ—¶é—´ï¼Œ bi  date-now ç²¾ç¡®")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("now")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" performance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ—¶é—´ ï¼Œç²¾ç¡®")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»ä»»åŠ¡queueä¸­ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª ä»»åŠ¡ ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("peek")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("arr")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// schedule â€”> æŠŠæˆ‘çš„ä»»åŠ¡æ”¾è¿›ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç„¶åä»¥æŸä¸€ç§èŠ‚å¥è¿›è¡Œæ‰§è¡Œï¼›")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startTranstion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ­¤æ—¶ï¼Œæ˜¯å¦åº”è¯¥äº¤å‡ºæ‰§è¡Œæƒ å¦‚æœè¯´æœ‰ç”¨æˆ·è¾“å…¥ æˆ–è€…æ‰§è¡Œæ—¶é—´å¤ªé•¿(è¶…æ—¶) å…¶å®å°±æ˜¯è¿‡äº†16.66ms")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldYield")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" navigator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scheduling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isInputPending")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" deadline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œæƒçš„åˆ‡æ¢")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startTranstion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    transtions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œæƒçš„åˆ‡æ¢")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" postMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("cb")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" transtions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splice")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("c")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageChannel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    port1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onmessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" port2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¨¡æ‹Ÿå®ç° requestIdleCallback æ–¹æ³•")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("flush")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç”Ÿæˆæ—¶é—´ï¼Œç”¨äºåˆ¤æ–­")]),t._v("\n    deadline "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" threshold"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" task "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("peek")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æˆ‘è¿˜æ²¡æœ‰è¶…å‡º 16.666ms åŒæ—¶ï¼Œä¹Ÿæ²¡æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§æ‰“æ–­æˆ‘ å°±ç»§ç»­æ‰§è¡Œ")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldYield")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" cb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›¸å½“äºæœ‰ä¸€ä¸ªçº¦å®šï¼Œå¦‚æœï¼Œä½ è¿™ä¸ªtask è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¸‹ä¸€æ¬¡ï¼Œå°±ä»ä½ è¿™é‡Œæ¥ç€è·‘")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é‚£å¦‚æœ task è¿”å›çš„ä¸æ˜¯å‡½æ•°ï¼Œè¯´æ˜å·²ç»è·‘å®Œäº†ã€‚ä¸éœ€è¦å†ä»ä½ è¿™é‡Œè·‘äº†")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"function"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shift")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        task "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("peek")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæˆ‘çš„è¿™ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œæ‰§è¡Œå®Œäº†ï¼Œåˆ°äº†è¿™é‡Œã€‚")]),t._v("\n    task "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startTranstion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br")])]),n("h2",{attrs:{id:"reactçš„æµç¨‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reactçš„æµç¨‹"}},[t._v("#")]),t._v(" reactçš„æµç¨‹")]),t._v(" "),n("ul",[n("li",[t._v("é¦–æ¬¡ç”Ÿäº§fiber")]),t._v(" "),n("li",[t._v("æ›´æ–°çš„æ—¶å€™è°ƒç”¨renderå‡½æ•°ç”Ÿäº§è™šæ‹Ÿdomï¼Œvdomæ ¹æ—§çš„fiberå¯¹æ¯”ï¼ŒbeginWork")]),t._v(" "),n("li",[t._v("å¯¹æ¯”åˆ°ä¹ˆæœ‰å­å‡ ç‚¹çš„å¼€å§‹å®ŒæˆcomplateWorkï¼Œç„¶åå¯¹æ¯”å…„å¼ŸèŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹")]),t._v(" "),n("li",[t._v("å¯¹æ¯”ç»“æŸç”Ÿäº§workInProgressFiber,ç”Ÿäº§ç¯å½¢çš„æ›´æ–°é˜Ÿåˆ—")]),t._v(" "),n("li",[t._v("commité˜¶æ®µæ¸²æŸ“ä¸ºçœŸå®çš„dom")])])])}),[],!1,null,null,null);s.default=e.exports}}]);