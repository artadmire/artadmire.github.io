(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{711:function(s,a,t){"use strict";t.r(a);var e=t(13),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"搭建一个组件库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建一个组件库"}},[s._v("#")]),s._v(" 搭建一个组件库")]),s._v(" "),t("h2",{attrs:{id:"开始"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[s._v("#")]),s._v(" 开始")]),s._v(" "),t("p",[s._v("目标：一个仓库内管理多个项目，以多个npm包方式发布，依赖集中管理，npm包版本可以集中管理，也可以单独管理。通常适用于有一定关联的组件，但各组件需要支持单独的npm包发布和安装。")]),s._v(" "),t("p",[s._v("优点：")]),s._v(" "),t("ul",[t("li",[s._v("共同依赖统一管理，版本控制更加容易，依赖管理会变的方便。")]),s._v(" "),t("li",[s._v("支持组件的单独发布和单独构建。")]),s._v(" "),t("li",[s._v("使用时可以单独引入。")])]),s._v(" "),t("p",[s._v("缺陷：")]),s._v(" "),t("ul",[t("li",[s._v("项目搭建复杂度高。")])]),s._v(" "),t("p",[s._v("需要做什么？")]),s._v(" "),t("ul",[t("li",[s._v("代码验证")]),s._v(" "),t("li",[s._v("单元测试 jest")]),s._v(" "),t("li",[s._v("构建rollup & webpack")]),s._v(" "),t("li",[s._v("支持ts")]),s._v(" "),t("li",[s._v("提交卡点")]),s._v(" "),t("li",[s._v("组件库文档编写")])]),s._v(" "),t("h3",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("诸多选择以后，我觉得选择pnpm搭建自己的组件库。")]),s._v(" "),t("p",[s._v("理由如下：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("lerna 已经不再维护，后续有任何问题社区无法及时响应。")])]),s._v(" "),t("li",[t("p",[s._v("pnpm 非常适合「单仓多包」的项目，即 monorepo。pnpm 不仅速度够快，占用的空间更小，尤其是 monorepo 项目，一个仓库下的多个项目可共用依赖包，各个项目可通过软链索引到依赖包的实际位置（类似文件夹快捷方式），而不需要每个项目都安装一份，大大节省了存储空间。")])]),s._v(" "),t("li",[t("p",[s._v("pnpm 的使用命令和 npm 类似，迁移学习成本低，基本看一遍官方文档就能上手。")])]),s._v(" "),t("li",[t("p",[s._v("既然大家都说它很好用，不去尝试一下怎么行呢？")])])]),s._v(" "),t("h3",{attrs:{id:"初始化仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化仓库"}},[s._v("#")]),s._v(" 初始化仓库")]),s._v(" "),t("p",[s._v("mkdir art-ui")]),s._v(" "),t("p",[s._v("cd art-ui")]),s._v(" "),t("p",[s._v("npm init")]),s._v(" "),t("h3",{attrs:{id:"构建目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建目录结构"}},[s._v("#")]),s._v(" 构建目录结构")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("art-ui\n    ├── README.md\n    ├── package.json\n    └── packages\n        ├── maile-ui\n        │   ├── README.md\n        │   ├── __tests__\n        │   ├── src\n        │   └── package.json\n        └── maile-utils\n            ├── README.md\n            ├── __tests__\n            ├── src\n            └── package.json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"创建workspace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建workspace"}},[s._v("#")]),s._v(" 创建workspace")]),s._v(" "),t("p",[s._v("根目录下新建pnpm-workspace.yaml")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("packages:\n  - 'packages/*'\n  - 'examples/*'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[s._v("#")]),s._v(" 安装依赖")]),s._v(" "),t("ol",[t("li",[s._v("根目录下安装")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pnpm install typescript -D -W\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("单独安装")])]),s._v(" "),t("p",[s._v("比如我们只在 @maile/ui 应用中用到react，那就可以为它单独安装。首先要拿到它的 package name，这个是我们在子项目中自定义的，那么命令如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pnpm install @maile/utils -r --filter @maile/ui\n\npnpm i -r --filter vite-ts\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("相互依赖")])]),s._v(" "),t("p",[s._v("在 monorepo 中，我们往往需要 package 间的引用，比如本例中的@maile/utils就会被@maile/ui依赖，或者还有maile-cli。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pnpm i @maile/utils -r --filter @maile/ui @maile/cli\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这个时候就可以在@maile/ui中使用了:")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" debounce "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@maile/utils'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("当执行了pnpm publish后，会把基于的workspace的依赖变成外部依赖，如：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// before  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"@maile/utils"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:^1.0.0"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// after")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"@maile/utils"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^1.0.0"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发"}},[s._v("#")]),s._v(" 开发")]),s._v(" "),t("p",[s._v("一个 monorepo 往往是一个整体的项目，所以我们需要同时执行多个指令，在 pnpm 中，可以通过-C进行配置：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pnpm -C ./packages/maile-ui build "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("前提是你的子项目中需要有以下命令。")]),s._v(" "),t("h3",{attrs:{id:"eslint-prettier-stylelint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eslint-prettier-stylelint"}},[s._v("#")]),s._v(" Eslint&Prettier#Stylelint")]),s._v(" "),t("h3",{attrs:{id:"提交卡点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提交卡点"}},[s._v("#")]),s._v(" 提交卡点")]),s._v(" "),t("h3",{attrs:{id:"支持ts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持ts"}},[s._v("#")]),s._v(" 支持TS")]),s._v(" "),t("p",[s._v("tsconfig.json")]),s._v(" "),t("h2",{attrs:{id:"package-json相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package-json相关"}},[s._v("#")]),s._v(" package.json相关")]),s._v(" "),t("h3",{attrs:{id:"private"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#private"}},[s._v("#")]),s._v(" private")]),s._v(" "),t("p",[s._v("private为true为拒绝发布到npm。")]),s._v(" "),t("h3",{attrs:{id:"devdependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#devdependencies"}},[s._v("#")]),s._v(" devDependencies")]),s._v(" "),t("p",[s._v("项目开发环境下所需要的依赖。")]),s._v(" "),t("h3",{attrs:{id:"dependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dependencies"}},[s._v("#")]),s._v(" dependencies")]),s._v(" "),t("p",[s._v("项目生产环境下所需要的依赖")]),s._v(" "),t("h3",{attrs:{id:"peerdependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#peerdependencies"}},[s._v("#")]),s._v(" peerDependencies")]),s._v(" "),t("p",[s._v("在主系统的 package.json 中的 dependencies 声明下 react 和 react-dom 的版本：")]),s._v(" "),t("p",[s._v("主系统package.json:")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"dependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"react"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^16.13.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"react-dom"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^16.13.1"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("接着在组件库的 package.json 中的 peerDependencies 声明 react 和 react-dom 的版本：")]),s._v(" "),t("p",[s._v("组件库的package.json：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"peerDependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"react"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">=16.12.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"react-dom"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">=16.12.0"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("这样在主系统中执行 $ npm install 之后，主系统和组件库就能共用主系统的 node_module 中安装的 react 和 react-dom 了。")])])}),[],!1,null,null,null);a.default=n.exports}}]);