(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{700:function(t,s,a){"use strict";a.r(s);var n=a(13),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"小程序机制介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序机制介绍"}},[t._v("#")]),t._v(" 小程序机制介绍")]),t._v(" "),a("h2",{attrs:{id:"_1-什么是小程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是小程序"}},[t._v("#")]),t._v(" 1. 什么是小程序?")]),t._v(" "),a("p",[t._v("小程序⻚面本质上是网⻚：")]),t._v(" "),a("ol",[a("li",[t._v("使用技术栈与网⻚开发是一致的，都用到HTML、CSS和JS；")]),t._v(" "),a("li",[t._v("区别：不支持浏览器API，只能用微信提供的API；")]),t._v(" "),a("li",[t._v("要有宿主环境, 微信, 支付宝等等")])]),t._v(" "),a("p",[t._v("外部代码通过小程序这种形式，在手机 App 里面运行：微信、支付宝， 小程序可以视为只能用微信等APP作为载体打开和浏览的网站。")]),t._v(" "),a("h2",{attrs:{id:"_2-小程序的发展历程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-小程序的发展历程"}},[t._v("#")]),t._v(" 2. 小程序的发展历程")]),t._v(" "),a("h3",{attrs:{id:"_1-微信小程序形态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-微信小程序形态"}},[t._v("#")]),t._v(" 1. 微信小程序形态：")]),t._v(" "),a("ul",[a("li",[t._v("a. 小程序从业务形式上更像是公众号开发的演变产物；")]),t._v(" "),a("li",[t._v("b. 早期微信通过 sdk 的形式，增强了开发者开发公众号网⻚的能力；")]),t._v(" "),a("li",[t._v("c. 小程序的诞生是微信本身迈向平台化超级 App 的业务行为，并且帮助用户更好的实现了「轻量\n级 Web App」；")])]),t._v(" "),a("h3",{attrs:{id:"_2-开发标准"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-开发标准"}},[t._v("#")]),t._v(" 2. 开发标准：")]),t._v(" "),a("ul",[a("li",[t._v("a. 最初微信小程序自己定义了一套”标准“，最开始的框架甚至没有组件、没有 npm，和 Web 生\n态严重脱节；")]),t._v(" "),a("li",[t._v("b. 由于特殊的双线程模型与四不像的语法，开发者苦不堪言，小程序的开放只是对三方业务的开\n放而已；")])]),t._v(" "),a("h3",{attrs:{id:"_3-商家涌入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-商家涌入"}},[t._v("#")]),t._v(" 3. 商家涌入：")]),t._v(" "),a("ul",[a("li",[t._v("a. 小程序业务的开放性 ->平台型 App；")]),t._v(" "),a("li",[t._v("b. 比如：支付宝小程序、百度小程序、淘宝小程序、360小程序、快应用......")]),t._v(" "),a("li",[t._v("c. 小程序设计目的：大多数选择了和微信类似的架构、框架，更多不是从技术⻆度考虑，而是想\n尽可能蹭微信小程序的福利，让开发者可以更快的投放到自己的平台；")])]),t._v(" "),a("h2",{attrs:{id:"原生微信小程序框架介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原生微信小程序框架介绍"}},[t._v("#")]),t._v(" 原生微信小程序框架介绍")]),t._v(" "),a("h3",{attrs:{id:"_1-小程序的目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-小程序的目录结构"}},[t._v("#")]),t._v(" 1. 小程序的目录结构")]),t._v(" "),a("p",[t._v("工程的工作目录中包含以下文件：")]),t._v(" "),a("h3",{attrs:{id:"_2-技术选型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-技术选型"}},[t._v("#")]),t._v(" 2. 技术选型")]),t._v(" "),a("p",[t._v("渲染界面的技术方案：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("用纯客户端原生技术渲染；")])]),t._v(" "),a("li",[a("p",[t._v("用纯 Web 技术渲染；")])]),t._v(" "),a("li",[a("p",[t._v("用客户端原生技术与 Web 技术结合的混合技术（简称 Hybrid 技术）渲染；\n方案对比：")])]),t._v(" "),a("li",[a("p",[t._v("开发⻔槛：Web ⻔槛低，Native 也有像 RN 这样的框架支持；")])]),t._v(" "),a("li",[a("p",[t._v("体验：Native 体验比 Web 要好太多，Hybrid 在一定程度上比 Web 接近原生体验；")])]),t._v(" "),a("li",[a("p",[t._v("版本更新：Web 支持在线更新，Native 则需要打包到微信一起审核发布；")])]),t._v(" "),a("li",[a("p",[t._v("管控和安全：Web 可跳转或是改变⻚面内容，存在一些不可控因素和安全⻛险；")])])]),t._v(" "),a("p",[t._v("方案确定：")]),t._v(" "),a("ol",[a("li",[t._v("小程序的宿主环境是微信等手机 APP，用纯客户端原生技术来编写小程序，那么小程序代码每次都\n需要与手机 APP 代码一起发版❎；")]),t._v(" "),a("li",[t._v("Web 支持有一份副本资源包放在云端，通过下载到本地，动态执行后即可渲染出界面，但纯 Web\n技术在一些复杂的交互上可能会面临一些性能问题❎；\na. 在 Web 技术中，UI 渲染跟脚本执行都在一个单线程中执行，这就容易导致一些逻辑任务抢占\nUI渲染的资源。")]),t._v(" "),a("li",[t._v("两者结合起来的 Hybrid 技术来渲染小程序，用一种近似 Web 的方式来开发，并且可以实现在线更新代码✅；")])]),t._v(" "),a("ul",[a("li",[t._v("a. 扩展 Web 的能力。比如像输入框组件（input, textarea）有更好地控制键盘的能力；")]),t._v(" "),a("li",[t._v("b. 体验更好，同时也减轻 WebView 的渲染工作；")]),t._v(" "),a("li",[t._v("c. 用客户端原生渲染内置一些复杂组件，可以提供更好的性能；")])]),t._v(" "),a("h3",{attrs:{id:"_3-双线程模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-双线程模型"}},[t._v("#")]),t._v(" 3. 双线程模型")]),t._v(" "),a("p",[t._v("小程序的渲染层和逻辑层分别由 2 个线程管理：")]),t._v(" "),a("ol",[a("li",[t._v("视图层 -> WebView 进行渲染；")]),t._v(" "),a("li",[t._v("逻辑层 -> JsCore 线程运行 JS脚本；")])]),t._v(" "),a("p",[t._v("设计目的：为了管控和安全等问题，阻止开发者使用一些，例如浏览器的window对象，跳转⻚面、操\n作DOM、动态执行脚本的开放性接口；\n使用沙箱环境提供纯 JavaScript 的解释执行环境")]),t._v(" "),a("ol",[a("li",[t._v("客户端系统：JavaScript 引擎；")]),t._v(" "),a("li",[t._v("iOS ： JavaScriptCore 框架；")]),t._v(" "),a("li",[t._v("安卓：腾讯 x5 内核提供的 JsCore ；")])]),t._v(" "),a("p",[t._v("小程序双线程模型：")]),t._v(" "),a("ul",[a("li",[t._v("逻辑层：创建一个单独的线程去执行 JavaScript，在这里执行的都是有关小程序业务逻辑的代码，\n负责逻辑处理、数据请求、接口调用等；")]),t._v(" "),a("li",[t._v("视图层：界面渲染相关的任务全都在 WebView 线程里执行，通过逻辑层代码去控制渲染哪些界\n面。一个小程序存在多个界面，所以视图层存在多个 WebView 线程；")]),t._v(" "),a("li",[t._v("JSBridge 起到架起上层开发与Native（系统层）的桥梁，使得小程序可通过API使用原生的功能，且部分组件为原生组件实现，从而有良好体验；")])]),t._v(" "),a("h3",{attrs:{id:"_4-数据驱动视图变化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-数据驱动视图变化"}},[t._v("#")]),t._v(" 4. 数据驱动视图变化")]),t._v(" "),a("p",[t._v("问题：JS 逻辑代码放到单独的线程去运行，在 Webview 线程里没法直接操作 DOM。开发者如何实现\n动态更改界面呢？")]),t._v(" "),a("p",[t._v("DOM 的更新通过简单的数据通信来实现 .逻辑层和视图层的通信会由 Native （微信客户端）做中转，逻辑层发送网络请求也经由 Native 转发。 JS 对象模拟 DOM 树 -> 比较两棵虚拟 DOM 树的差异 -> 把差异应用到真正的 DOM 树上。")]),t._v(" "),a("ol",[a("li",[t._v("在渲染层把 WXML 转化成对应的 JS 对象；")]),t._v(" "),a("li",[t._v("在逻辑层发生数据变更的时候，通过宿主环境提供的 setData 方法把数据从逻辑层传递到 Native，再转发到渲染层；")]),t._v(" "),a("li",[t._v("经过对比前后差异，把差异应用在原来的 DOM 树上，更新界面；")])]),t._v(" "),a("h3",{attrs:{id:"_5-事件的处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-事件的处理"}},[t._v("#")]),t._v(" 5. 事件的处理")]),t._v(" "),a("p",[t._v("视图层需要进行交互，这类反馈应该通知给开发者的逻辑层，需要将对应的处理状态呈现给用户。")]),t._v(" "),a("p",[t._v("视图层的功能只是进行渲染，因此对于事件的分发处理，微信进行了特殊的处理，将所有的事件拦截\n后，丢到逻辑层交给JS处理。")]),t._v(" "),a("p",[t._v("事件的派发处理包括事件捕获和冒泡两种：")]),t._v(" "),a("p",[t._v("通过native传递给 JSCore，通过 JS 来响应响应的事件之后，对 Dom 进行修改，改动会体现在虚拟\nDom 上，然后再进行真实的渲染。")]),t._v(" "),a("h3",{attrs:{id:"_6-运行机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-运行机制"}},[t._v("#")]),t._v(" 6. 运行机制")]),t._v(" "),a("p",[t._v("小程序启动机制：")]),t._v(" "),a("ol",[a("li",[t._v("冷启动：用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启\n动。")]),t._v(" "),a("li",[t._v("热启动：假如用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时无需重新启\n动，只需将后台状态的小程序切换到前台；")])]),t._v(" "),a("p",[t._v("注意：")]),t._v(" "),a("ul",[a("li",[t._v("小程序没有重启的概念；")]),t._v(" "),a("li",[t._v("当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后（目前是5分钟）会被微信主动销毁；")]),t._v(" "),a("li",[t._v("当短时间内（5s）连续收到两次以上收到系统内存告警，会进行小程序的销毁；")])]),t._v(" "),a("h2",{attrs:{id:"小程序框架对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序框架对比"}},[t._v("#")]),t._v(" 小程序框架对比")]),t._v(" "),a("h3",{attrs:{id:"_1-小程序原生语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-小程序原生语法"}},[t._v("#")]),t._v(" 1. 小程序原生语法")]),t._v(" "),a("ol",[a("li",[t._v("目前小程序生态支持开发者利用前端部分生态开发应用的；")]),t._v(" "),a("li",[t._v("目前小程序已经能够做到前端工程化，并且植入前端生态中已有的一些理念，例如状态管理、CLI\n工程化等等，与早期 npm 能力的缺失、只能通过模板渲染实现组件化不可同日而语；")]),t._v(" "),a("li",[t._v("当业务的需求只有投放到微信或者支付宝小程序时，原生语法可以成为前端程序员们的一个选择；\n前端能力基本都可以在小程序上复用（如状态管理库颗粒化管理组件状态、TS等）；")])]),t._v(" "),a("h3",{attrs:{id:"_2-增强型框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-增强型框架"}},[t._v("#")]),t._v(" 2. 增强型框架")]),t._v(" "),a("p",[t._v("指小程序引入 npm 之后，有了更加开放的能力所带来的收益；")]),t._v(" "),a("p",[t._v("以小程序原生语法为主，在逻辑层引入了增强语法来优化应用性能或者提供更便捷的使用方法；")]),t._v(" "),a("p",[t._v("Example：腾讯开源的 omix 框架为例")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 逻辑层")]),t._v("\ncreate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Page")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明依赖")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("computed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("logsLength")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onLoad")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//响应式，自动更新视图")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStorageSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//响应式，自动更新视图")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Changed!'")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//视图层")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("view "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"container log-list"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("block wx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{logs}}"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("wx")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("text "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log-item"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("block"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("ol",[a("li",[t._v("整体保留小程序已有的语法，但在此基础之上，对它进行了扩充和增强；")]),t._v(" "),a("li",[t._v("比如引入了 Vue 中比较有代表性的 computed，比如能够直接通过 this.store.data.logs[0] =\n'Changed' 修改状态。可以说是在小程序原生半 Vue 半 React 的语法背景下，彻底将其 Vue 化的\n一种方案；")])]),t._v(" "),a("p",[t._v("使用增强型框架优势：")]),t._v(" "),a("ol",[a("li",[t._v("可以在只引入极少依赖，并且保留对小程序认知的情况下，用更加舒爽的语法来写代码；")]),t._v(" "),a("li",[t._v("对于目标只投放到特定平台小程序的开发者或者非专业前端而言是比较好的选择之一；因为你只需\n要关注很少的新增文档和小程序自身的文档就足够了，底层不需要考虑；")])]),t._v(" "),a("h3",{attrs:{id:"_3-转换类框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-转换类框架"}},[t._v("#")]),t._v(" 3. 转换类框架")]),t._v(" "),a("p",[t._v("目的：让开发者几乎不用感受小程序原生语法，更大程度对接前端已有生态，并且可以实现「一码多\n端」的业务诉求，只是最后的构建产物为小程序代码。")]),t._v(" "),a("h4",{attrs:{id:"编译时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译时"}},[t._v("#")]),t._v(" 编译时")]),t._v(" "),a("p",[t._v("通过编译分析的方式，将开发者写的代码转换成小程序原生语法。")]),t._v(" "),a("p",[t._v("以 Rax 编译时和 Taro 2.0 为例，面向开发者的语法是类 React 语法，开发者通过写有一定语法限制的 React 代码，最后转换产物 1:1 转换成对应的小程序代码。")]),t._v(" "),a("p",[t._v("开发者代码--- AST语法树---新的AST语法树---小程序代码")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// raximport { createElement, useEffect, useState } from 'rax';import View from 'rax-view';export default function Home() {  const [name, setName] = useState('world');  useEffect(() => {    console.log('Here is effect.');  }, [])  return <View>Hello {name}</View>;}// 转为小程序后的代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 逻辑层")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" __create_component__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useEffect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useState "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsx2mp-runtime/dist/ali.esm.js'")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Home")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Here is effect.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_updateData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("_d0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" name  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("__create_component__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 视图层")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("block a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{$ready}}"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("view "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__rax-view"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_d0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("block"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("优势:")]),t._v(" "),a("ol",[a("li",[t._v("运行时性能损耗低；")]),t._v(" "),a("li",[t._v("目标代码明确，开发者所写即所得；")]),t._v(" "),a("li",[t._v("运行时、编译时优化：比如框架会给予开发者更多的语法支持以及默认的性能优化处理，比如避免\n多次 setData，亦或是⻓列表优化等等；")])]),t._v(" "),a("p",[t._v("劣势：")]),t._v(" "),a("ol",[a("li",[t._v("语法限制高：需要完全命中开发者在模板部分所用到的所有语法，语法受限，如由于是 1:1 编译转\n换，开发者在开发的时候还是不得不去遵循小程序的开发规范，比如一个文件中定义只能定义一个\n组件之类的；")])]),t._v(" "),a("h4",{attrs:{id:"运行时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行时"}},[t._v("#")]),t._v(" 运行时")]),t._v(" "),a("p",[t._v("相比于上面的编译时，最大的优势是可以几乎没有任何语法约束的去完成代码编写。")]),t._v(" "),a("p",[t._v("通过在逻辑层模拟 DOM/BOM API，将这些创建视图的方法转换为维护一棵 VDOM tree，再将其转换\n成对应 setData 的数据，最后通过预置好的模板递归渲染出实际视图。")]),t._v(" "),a("p",[t._v("优势：没有语法限制；")]),t._v(" "),a("p",[t._v("劣势：以一定的性能损耗来换取更为全面的 Web 端特性支持；")])])}),[],!1,null,null,null);s.default=e.exports}}]);